% !TEX program = pdflatex
\documentclass[12pt]{article}
\usepackage{geometry}
\usepackage{CJKutf8}
\usepackage[normalem]{ulem}
\usepackage{array}
\usepackage{graphicx}
\usepackage{pgfkeys}

\geometry{
  paper=a4paper,
  top=2.54cm,
  bottom=2.54cm,
  left=3.18cm,
  right=3.18cm
}
\setlength{\parindent}{2em}
\setlength{\parskip}{0pt}
\renewcommand{\normalsize}{\fontsize{12pt}{20pt}\selectfont}
\normalsize

% Table helpers
\setlength{\tabcolsep}{1.9mm}
\setlength{\arrayrulewidth}{0.5pt}
\renewcommand{\arraystretch}{1.15}
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}} % center with vertical middle
\newcolumntype{L}[1]{>{\arraybackslash}p{#1}}

% Column widths scaled from the original DOCX (sum = 1.0)
\newlength{\ContentWidth}
\newlength{\ColA}
\newlength{\ColB}
\newlength{\ColC}
\newlength{\ColD}
\newlength{\ColE}
\newlength{\ColF}
\newlength{\ColDEF}
\newlength{\ColTotal}
% Use the full text width so网格线只画一次不留额外空白，避免边缘位置叠线变粗
\setlength{\ContentWidth}{\dimexpr\textwidth-12\tabcolsep-7\arrayrulewidth\relax}
\setlength{\ColA}{0.10\ContentWidth} % 标签1宽度
\setlength{\ColB}{0.28\ContentWidth} % 值1宽度（与ColF对称）
\setlength{\ColC}{0.05\ContentWidth} % 标签2宽度
\setlength{\ColD}{0.19\ContentWidth} % 值2宽度
\setlength{\ColE}{0.10\ContentWidth} % 标签3宽度（与ColA对称）
\setlength{\ColF}{0.28\ContentWidth} % 值3宽度（与ColB对称）
\setlength{\ColDEF}{\dimexpr\ColD+\ColE+\ColF\relax}
\setlength{\ColTotal}{\ContentWidth}

% Content placeholders managed via key-value interface
\newcommand{\FieldCollege}{}
\newcommand{\FieldWeekNumber}{}
\newcommand{\FieldMajor}{}
\newcommand{\FieldProjectTitle}{}
\newcommand{\FieldStudentName}{}
\newcommand{\FieldStudentID}{}
\newcommand{\FieldAdvisor}{}
\newcommand{\MainWorkContent}{}
\newcommand{\IssueContent}{}
\newcommand{\PlanContent}{}
\newcommand{\AdvisorOpinion}{}

\pgfkeys{
  /weeklylog/.is family,
  /weeklylog,
  reset/.style={/weeklylog/.cd,
    college = {},
    week = {},
    major = {},
    title = {},
    student = {},
    id = {},
    advisor = {},
    work = {},
    issue = {},
    plan = {},
    opinion = {}
  },
  college/.code={\renewcommand*{\FieldCollege}{#1}},
  week/.code={\renewcommand*{\FieldWeekNumber}{#1}},
  major/.code={\renewcommand*{\FieldMajor}{#1}},
  title/.code={\renewcommand*{\FieldProjectTitle}{#1}},
  student/.code={\renewcommand*{\FieldStudentName}{#1}},
  id/.code={\renewcommand*{\FieldStudentID}{#1}},
  advisor/.code={\renewcommand*{\FieldAdvisor}{#1}},
  work/.code={\renewcommand*{\MainWorkContent}{#1}},
  issue/.code={\renewcommand*{\IssueContent}{#1}},
  plan/.code={\renewcommand*{\PlanContent}{#1}},
  opinion/.code={\renewcommand*{\AdvisorOpinion}{#1}}
}

\newcommand{\WeeklyLogEntry}[1]{%
  \pgfkeys{/weeklylog/reset}%
  \pgfkeys{/weeklylog/.cd, #1}%
}

\newsavebox{\SectionBoxTmp}
\newcommand{\SectionBox}[2]{% #1 min height; expands if content taller
  \setbox\SectionBoxTmp=\vbox{\begin{minipage}[t]{\linewidth}#2\end{minipage}}%
  \dimen0=\dimexpr\ht\SectionBoxTmp+\dp\SectionBoxTmp\relax
  \ifdim\dimen0<#1
    \vbox to #1{\unvbox\SectionBoxTmp\vfill}%
  \else
    \unvbox\SectionBoxTmp
  \fi}

% 简化全宽行的写法，保证每段只画一条横线避免线条叠加
% \newcommand{\FullRowHeading}[1]{\multicolumn{6}{|L{\ColTotal}|}{\textbf{#1}}\\\hline}
% \newcommand{\FullRowContent}[2]{\multicolumn{6}{|L{\ColTotal}|}{\SectionBox{#1}{#2}}\\\hline}
\newcommand{\FullRowHeading}[1]{\multicolumn{6}{|L{\textwidth}|}{\textbf{#1}}\\\hline}
\newcommand{\FullRowContent}[2]{\multicolumn{6}{|L{\textwidth}|}{\SectionBox{#1}{#2}}\\\hline}
\newcommand{\FullRow}[3]{%
  \FullRowHeading{#1}%
  \FullRowContent{#2}{#3}%
}

% 这块导致学院名会超过空行
% \newcommand{\CollegeSlot}{\uline{\makebox[4em][c]{\FieldCollege}}}
\newcommand{\CollegeSlot}{\uline{\FieldCollege}}
\newcommand{\WeekSlot}{\makebox[4em][c]{\FieldWeekNumber}}
\newcommand{\TitleFont}{\fontsize{16pt}{24pt}\selectfont}
\newcommand{\songti}{\CJKfamily{gbsn}}

\WeeklyLogEntry{%
college = 网络与信息安全学院,
week = 7,
major = 网络空间安全,
title = {推箱子小程序设计},
student = 你的名字,
id = 你的学号,
advisor = 你的指导老师,
work = {1）核心模块功能已基本完善，完成相关代码更新，提升模块稳定性和功能完整性；\par 2）已修复上周发现的多个缺陷，修复代码已提交，缺陷率明显下降；\par 3）完成模块间的集成测试，测试报告已初步形成，系统整体运行较为稳定。},
issue = {1）问题：集成过程中出现系统不稳定现象；思路：制定详细测试计划，逐步定位问题模块并修复；\par 2）问题：部分功能模块接口兼容性不足；思路：加强模块间接口定义和联调，确保数据传递准确。},
plan = {1）继续开发辅助功能模块，确保系统功能的扩展性；\par 2）对已有模块进行性能优化，提升系统响应速度和资源利用率；\par 3）完善系统整体功能，结合本周集成测试结果调整优化方案。},
opinion = {同意\par\vspace{0.6cm}\makebox[\linewidth][r]{指导教师（签名）：\hspace{0.8em}\raisebox{-0.4cm}{\includegraphics[width=2.8cm]{sign.jpg}}}}
}
\begin{document}
\begin{CJK*}{UTF8}{gbsn}
\songti
\normalsize
\thispagestyle{empty}

%\begin{center}
%  {\bfseries\TitleFont\CollegeSlot\,毕业设计（论文）周记\quad 第\,\WeekSlot\,周}
%\end{center}

\noindent
{\bfseries\TitleFont
\begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} c r}
\CollegeSlot\,毕业设计（论文）周记 & 第\kern-1.3em \WeekSlot\kern-1.3em 周
\end{tabular*}}

\vspace{0.3em}

\begin{center}
\begin{tabular}{|M{\ColA}|M{\ColB}|M{\ColC}|M{\ColD}|M{\ColE}|M{\ColF}|}
\hline
\textbf{专业} & \FieldMajor & \textbf{题目} & \multicolumn{3}{M{\ColDEF}|}{\FieldProjectTitle} \\
\hline
\textbf{学生姓名} & \FieldStudentName & \textbf{学号} & \FieldStudentID & \textbf{指导教师} & \FieldAdvisor \\
\hline
\FullRow{1. 主要工作内容和进展}{3.8cm}{\MainWorkContent}
\FullRow{2. 存在的主要问题和解决办法与思路}{2cm}{\IssueContent}
\FullRow{3. 下周工作计划}{2.4cm}{\PlanContent}
\FullRow{4. 导师意见}{2.2cm}{\AdvisorOpinion}
\end{tabular}
\end{center}

\end{CJK*}
\end{document}
